services:
  - type: web
    name: salva-plantao
    env: node
    nodeVersion: 22
    buildCommand: npm ci && npm run build
    startCommand: npm run start
    
    # Health check configuration
    healthCheckPath: /health
    healthCheckInterval: 60  # seconds
    
    # Environment variables (set these in Render Dashboard)
    envVars:
      - key: NODE_ENV
        value: production
      
      # Database URL must be set in Render Dashboard
      # Format: postgresql://user:password@db.supabase.co:6543/postgres?sslmode=require
      - key: DATABASE_URL
        fromDatabase:
          name: salva-plantao-db
          property: connectionString
    
    # Auto-deploy on push
    autoDeploy: true
    
    # Build filter (only deploy on relevant changes)
    buildFilter:
      paths:
        - src/**
        - server/**
        - client/**
        - shared/**
        - package.json
        - vite.config.ts
        - script/**

databases:
  - name: salva-plantao-db
    databaseName: salva_plantao
    user: postgres
    postgresVersion: 15
